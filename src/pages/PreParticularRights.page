<apex:page title="{!$Label.UI_Text_Review}" controller="PreParticularsController" docType="html-5.0" showHeader="false" sidebar="false" action="{!initialiseAction}" standardStylesheets="false" applyHtmlTag="false" applyBodyTag="false">
    <apex:composition template="TransactionPageTemplate">
        <apex:define name="content">
            <apex:form id="formPanel">
                <apex:outputPanel id="masterPanel">
                    <apex:outputPanel rendered="{!hasPageErrors}">
                        <div class="error-summary" role="group" aria-labelledby="error-summary-heading-example-1" tabindex="-1">
                            <h1 class="heading-medium error-summary-heading" id="error-summary-heading-example-1">
                                An error has occurred.
                            </h1>
                            <p>
                                <span class="error-message"> {!currentErrorMessage}</span>
                            </p>
                        </div>
                    </apex:outputPanel>
                    <!-- note this needs to be set to true to show (inputs should be built already)  no need to change class of share as the dependency is already built -->
                    <apex:outputPanel rendered="{!hasStatementofCapital}">
                        <div class="form-group">
                            <h1 class="heading-xlarge"> {!headerText1}</h1>
                            <table class="check-your-answers">
                                <p> You need to tell us about prescribed particulars of rights attached to these shares for each class of share shown in the statement of share capital, for example relating to:
                                </p>
                                <p>
                                    <ul class="list list-bullet">
                                        <li>voting rights (including rights that only arise in certain circumstances)</li>
                                        <li>distribution of dividends</li>
                                        <li>distribution of capital (including on winding up)</li>
                                        <li>redeemable shares</li>
                                    </ul>
                                </p>
                                <p>The prescribed particulars listed on the public register for this class of shares in {!companyName} are:</p>
                                <thead>
                                    <tr>
                                        <th colspan="2">Statement of Capital</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <apex:repeat value="{!displayresult}" var="sp" id="theRepeat">
                                        <tr>
                                            <td>
                                                <h1>Class of shares</h1>
                                            </td>
                                            <td>
                                                <h1>Prescribed particulars</h1>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td scope="col">
                                                <apex:outputText value="{!sp.Class_of_Shares__c}" id="shareclass" />
                                            </td>
                                            <td scope="col">
                                                <apex:inputTextArea richText="false" rows="8" cols="40" value="{!sp.Prescribed_Particulars__c}" id="preparticularrights" />
                                            </td>
                                        </tr>
                                    </apex:repeat>
                                </tbody>
                            </table>
                            <br/>
                        </div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!preparticulardependency}">
                        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
                        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
                        <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
                        <div class="form-group">
                            <h1 class="heading-xlarge">
                                {!headerText1}
                            </h1>
                            <label class="form-label" for="classofShare-item">Class of shares
                                <span class="form-hint" name="classofShareHint" id="classHinttypetosearch">For example, Ordinary, Preference</span>
                            </label>
                            <input class="form-control" name="classofShare-item" id="dependencyShare" />
                            <apex:actionFunction action="{!setSelectedShare}" name="setSelectedShare" reRender="none">
                                <apex:param name="shareParam" value="" id="xyz" assignTo="{!classofshares}" />
                            </apex:actionFunction>
                            <label class="form-label" for="numberofshares">Prescribed particulars
                                <span class="form-hint" id="numberofsharesHint">Total number of issued shares in this class</span>
                            </label>
                            <apex:inputTextArea richText="false" rows="8" cols="40" value="{!prescribedParticular}" id="dependencypreparticularrights" />
                            <br/>
                            <apex:commandLink value="+ Add prescribe particulars" reRender="masterPanel" action="{!AddShare}" />
                        </div>
                        <script>
                        var sharetypes = ['Ordinary',
                            'Ordinary A',
                            'Ordinary B',
                            'Ordinary C',
                            'Preference',
                            'Deferred',
                            'Deferred Ordinary'
                        ];

                        $(function() {
                            $("#dependencyShare").autocomplete({
                                source: function(request, response) {
                                    var results = $.ui.autocomplete.filter(sharetypes, request.term);
                                    response(results.slice(0, 10));
                                },
                                select: function(event, ui) {
                                    var completedselection = ui.item.value;
                                    console.log('completed selection is ' + completedselection);
                                    if (completedselection.length < 1) {

                                        return;
                                    }
                                    if (completedselection.length > 1) {
                                        console.log('share from client = ' + ' ' + completedselection);
                                        setSelectedShare(completedselection);
                                    }
                                },
                                change: function(event, ui) {
                                    var completedselection = document.getElementById("dependencyShare").value;
                                    if (completedselection.length < 1) {

                                        return;
                                    }
                                    if (completedselection.length > 1) {
                                        console.log('share from client = ' + ' ' + completedselection);
                                        setSelectedShare(completedselection);
                                    }
                                }
                            });
                        });
                        </script>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!dependencyfulfilled}">
                        <div class="form-group entire-wrapper">
                            <table class="check-your-answers">
                                <thead>
                                    <tr>
                                        <th colspan="5"> {!headerText2} </th>
                                        <br/> {!headerText3}
                                    </tr>
                                </thead>
                                <tbody>
                                    <apex:repeat value="{!currentShares}" var="sp" id="thedependencyRepeat">
                                        <tr>
                                            <td scope="col">
                                                <h1>Class of shares</h1>
                                                <apex:outputText value="{!sp.Class_of_Shares__c}" id="repeatdependencyshareclass" />
                                            </td>
                                            <td scope="col">
                                                <h1>Prescribed particulars</h1>
                                                <apex:outputText value="{!sp.Prescribed_Particulars__c}" id="repeatdependencypreparticularrights" />
                                            </td>
                                        </tr>
                                    </apex:repeat>
                                </tbody>
                            </table>
                        </div>
                    </apex:outputPanel>
                </apex:outputPanel>
                <apex:commandButton rerender="none" styleClass="button" action="{!nextAction}" value="Save and continue" rendered="{!NOT(isLastPage)}" />
                <br/> &nbsp;
                <apex:commandLink action="{!previousAction}" value="{!$Label.UI_Text_Previous}" id="thePreviousButton" /> &nbsp;
            </apex:form>
        </apex:define>
    </apex:composition>
</apex:page>
